= ContactModal Component
:toc:
:toc-placement: preamble
:sectnums:
:icons: font

[.lead]
A comprehensive contact form modal with real-time validation, error handling, and bfcache-compatible submission processing.

== Overview

The `ContactModal` component provides a full-featured contact form within a modal dialog. It includes comprehensive form validation, real-time error feedback, submission states, and graceful error handling with back/forward cache compatibility.

== Component Details

[cols="1,3"]
|===
|*File Location* |`src/components/features/ContactModal.tsx`
|*Component Type* |Functional Component
|*Client/Server* |Client Component (`"use client"`)
|*Export Type* |Named Export
|===

== Props Interface

[cols="1,1,3,1"]
|===
|*Prop* |*Type* |*Description* |*Required*

|isOpen
|boolean
|Controls modal visibility state
|Yes

|onClose
|() => void
|Callback function executed when modal closes
|Yes
|===

== Type Definitions

[source,tsx]
----
interface IContactModalProps {
  isOpen: boolean;
  onClose: () => void;
}

type ValidationRule = {
  minLength?: number;
  pattern?: RegExp;
  required: boolean;
};

type FormData = {
  name: string;
  email: string;
  subject: string;
  message: string;
};

type FormErrors = {
  name?: string;
  email?: string;
  subject?: string;
  message?: string;
};

type SubmitStatus = "idle" | "success" | "error";
----

== Validation System

=== Validation Rules Configuration
[source,tsx]
----
const VALIDATION_RULES = {
  name: { minLength: 2, required: true },
  subject: { minLength: 3, required: true },
  message: { minLength: 10, required: true },
  email: { pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/, required: true },
} as const;
----

=== Validation Features
* **Real-time Validation**: Validates on input change and blur
* **Pattern Matching**: Email format validation with regex
* **Length Validation**: Minimum character requirements
* **Required Fields**: All fields mandatory for submission
* **Error Display**: Context-aware error messages

=== Validation Rules Detail
[cols="1,1,2,2"]
|===
|*Field* |*Type* |*Rule* |*Error Condition*

|name
|string
|minLength: 2, required
|Less than 2 characters or empty

|email
|string
|email pattern, required
|Invalid email format or empty

|subject
|string
|minLength: 3, required
|Less than 3 characters or empty

|message
|string
|minLength: 10, required
|Less than 10 characters or empty
|===

== State Management

=== Form State
[source,tsx]
----
const [formData, setFormData] = useState({
  name: "",
  email: "",
  subject: "",
  message: "",
});

const [errors, setErrors] = useState<FormErrors>({});
const [isSubmitting, setIsSubmitting] = useState(false);
const [submitStatus, setSubmitStatus] = useState<SubmitStatus>("idle");
----

=== State Flow
1. **Initial**: Empty form with idle status
2. **Typing**: Real-time validation updates errors
3. **Blur**: Field validation on focus loss
4. **Submitting**: Loading state with validation
5. **Success/Error**: Result state with user feedback

== Form Submission Process

=== Submission Flow
[source,tsx]
----
const handleSubmit = useCallback(async (e: FormEvent) => {
  e.preventDefault();

  if (!validateForm()) return;

  setIsSubmitting(true);
  setSubmitStatus("idle");

  try {
    // API simulation with bfcache compatibility
    await new Promise((resolve) =>
      setBfcacheTimeout(() => resolve(undefined), 2000)
    );

    setSubmitStatus("success");

    // Auto-close after success
    setBfcacheTimeout(() => {
      resetForm();
      onClose();
    }, 2000);
  } catch (error) {
    console.error("Error submitting form:", error);
    setSubmitStatus("error");
  } finally {
    setIsSubmitting(false);
  }
}, [validateForm, resetForm, onClose, setBfcacheTimeout]);
----

=== Bfcache Compatibility
The component uses `useBfcacheCompatibleTimeout` hook to ensure proper behavior when users navigate using browser back/forward buttons.

== Form Fields

=== Input Components
Each form field includes:
* **Label**: Semantic labeling for accessibility
* **Input/Textarea**: Styled form controls
* **Error Display**: Contextual error messages
* **Focus States**: Visual feedback for interaction

=== Field Specifications
[cols="1,1,2,3"]
|===
|*Field* |*Type* |*Placeholder* |*Styling*

|Name
|input[text]
|"Your Name"
|Standard text input with focus ring

|Email
|input[email]
|"your.email@example.com"
|Email input type with validation

|Subject
|input[text]
|"Subject"
|Text input for message topic

|Message
|textarea
|"Your message..."
|Multi-line textarea, 4 rows minimum
|===

== Visual Design

=== Layout Structure
* **Modal Container**: Full-screen overlay with backdrop
* **Form Container**: Centered card with grain texture
* **Header Section**: Title and close button
* **Form Grid**: Responsive field layout
* **Action Buttons**: Submit and cancel actions

=== Styling Features
* **Grain Texture**: Background noise overlay for depth
* **Glassmorphism**: Semi-transparent backgrounds
* **Focus States**: Emerald-colored focus rings
* **Error States**: Red error text with icons
* **Loading States**: Spinner and disabled controls

== Accessibility Implementation

=== Keyboard Navigation
* **Tab Order**: Logical focus progression through fields
* **ESC Key**: Modal closes via inherited Modal component
* **Enter Key**: Form submission (when valid)
* **Field Navigation**: Standard form navigation patterns

=== Screen Reader Support
* **Field Labels**: Proper label association with inputs
* **Error Messages**: Live regions for error announcements
* **Status Updates**: Form submission status announcements
* **Semantic HTML**: Proper form markup structure

=== ARIA Integration
* **Field Descriptions**: Error messages linked to fields
* **Live Regions**: Dynamic content updates announced
* **Button States**: Disabled/loading states communicated

== Error Handling

=== Validation Errors
* **Field-Level**: Individual field error display
* **Form-Level**: Complete form validation before submission
* **Real-Time**: Immediate feedback on input changes
* **Persistent**: Errors remain until corrected

=== Submission Errors
* **Network Errors**: Graceful handling of API failures
* **Timeout Handling**: Reasonable request timeout limits
* **User Feedback**: Clear error messages and recovery options
* **State Recovery**: Form data preserved on errors

== Performance Optimizations

=== React Optimizations
* **useCallback**: Memoized event handlers
* **Controlled Components**: Efficient state updates
* **Conditional Rendering**: Minimal re-renders
* **State Batching**: Grouped state updates

=== Form Optimizations
* **Debounced Validation**: Reduces excessive validation calls
* **Lazy Loading**: Modal only renders when open
* **Memory Management**: Proper cleanup on unmount

== Usage Examples

=== Basic Implementation
[source,tsx]
----
import { ContactModal } from "@/components/features/ContactModal";

const ContactSection = () => {
  const [showModal, setShowModal] = useState(false);

  return (
    <>
      <button onClick={() => setShowModal(true)}>
        Contact Me
      </button>

      <ContactModal
        isOpen={showModal}
        onClose={() => setShowModal(false)}
      />
    </>
  );
};
----

=== With State Management
[source,tsx]
----
const useContactModal = () => {
  const [isOpen, setIsOpen] = useState(false);

  return {
    isOpen,
    openModal: () => setIsOpen(true),
    closeModal: () => setIsOpen(false),
  };
};

// Usage
const { isOpen, openModal, closeModal } = useContactModal();
----

== Integration Patterns

=== API Integration
Replace the simulation with actual API calls:
[source,tsx]
----
// Replace in handleSubmit:
await fetch('/api/contact', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(formData)
});
----

=== Notification Integration
[source,tsx]
----
// Add toast notifications on success/error
if (submitStatus === "success") {
  toast.success("Message sent successfully!");
} else if (submitStatus === "error") {
  toast.error("Failed to send message. Please try again.");
}
----

== Dependencies

[cols="1,1,2"]
|===
|*Package* |*Import* |*Usage*

|@/assets/images/grain.jpg
|Default import
|Background texture image

|@/components/ui
|Modal
|Modal dialog wrapper component

|@/hooks/useBfcacheCompatible
|useBfcacheCompatibleTimeout
|Back/forward cache compatible timeouts

|react
|FormEvent, useCallback, useState
|Form handling and state management
|===

== Best Practices

=== Form Design
* **Clear Labels**: Descriptive field labels
* **Help Text**: Guidance for complex fields
* **Progress Indicators**: Show validation state
* **Consistent Styling**: Uniform field appearance

=== User Experience
* **Immediate Feedback**: Real-time validation
* **Error Recovery**: Clear error resolution paths
* **Success Confirmation**: Positive feedback on completion
* **Loading States**: Progress indication during submission

=== Accessibility
* **Keyboard Support**: Full keyboard navigation
* **Screen Reader**: Comprehensive screen reader support
* **Error Announcements**: Live error updates
* **Focus Management**: Logical tab order

== Related Components

* **Modal**: Base modal dialog component
* **Card**: Similar styling and layout patterns
* **SectionHeader**: Consistent heading styles
* **ErrorBoundary**: Error handling for form failures

== Change History

[cols="1,1,3"]
|===
|*Version* |*Date* |*Changes*

|1.0.0
|Current
|Initial implementation with comprehensive validation and bfcache support
|===
