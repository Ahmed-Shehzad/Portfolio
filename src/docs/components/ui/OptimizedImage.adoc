= OptimizedImage Component
:toc:
:toc-placement: preamble
:sectnums:
:icons: font
:revdate: 2025-08-09
:revremark: Initial documentation

[.lead]
Responsive image component wrapping Next.js Image with optional AVIF/WebP sources and graceful fallback handling.

== Overview
The `OptimizedImage` component enhances Next.js `Image` by supporting explicitly provided AVIF/WebP sources, automatic fallback, layout shift prevention, and error recovery.

== Component Details
[cols="1,3"]
|===
|*File Location* |`src/components/ui/OptimizedImage.tsx`
|*Type* |Functional Component (FC)
|*Client/Server* |Client (`"use client"`)
|*Export* |Named + Default
|===

== Props
[cols="1,1,3,1"]
|===
|*Prop* |*Type* |*Description* |*Required*
|src |`string | StaticImageData` |Primary image source |Yes
|alt |`string` |Accessible alt text |Yes
|webpSrc |`string | StaticImageData` |Optional explicit WebP source |No
|avifSrc |`string | StaticImageData` |Optional explicit AVIF source |No
|fallbackSrc |`string | StaticImageData` |Explicit fallback (defaults to src) |No
|...ImageProps |`next/image` props |All other Next.js Image props |No
|===

== Behavior
* Attempts AVIF > WebP > fallback ordering using `<picture>` when nextâ€‘gen props provided.
* Gracefully degrades on error by swapping to fallback source.
* Provides sensible default `sizes` and `quality` if not specified.
* Accepts either imported static images or raw string paths.

== Usage
[source,tsx]
----
import { OptimizedImage } from "@/components/ui/OptimizedImage";
import portraitAvif from "@/assets/images/me.avif";
import portraitWebp from "@/assets/images/me.webp";
import portraitJpg from "@/assets/images/me.jpg";

<OptimizedImage
  src={portraitJpg}
  avifSrc={portraitAvif}
  webpSrc={portraitWebp}
  alt="Profile portrait"
  width={320}
  height={320}
  priority
/>
----

== Error Handling
On image load failure the `onError` handler sets internal error state and re-renders with the fallback source only.

== Performance Notes
* Uses `<picture>` only when needed to avoid additional DOM.
* Reduces CLS via supplied `width`, `height`, and default `sizes`.
* Encourages modern formats while retaining compatibility.

== Accessibility
* Always provide meaningful `alt` text.
* Decorative images should use empty string `alt=""`.

== Change History
[cols="1,1,3"]
|===
|*Version* |*Date* |*Changes*
|1.0.0 |2025-08-09 |Initial documentation
|===
